services:
  app-gateway-docker-1:
    image: app-gateway:v1.0.0
    container_name: app-gateway-docker-1
    restart: always
    ports:
      - "6101:6101"
    environment:
      - TZ=Asia/Shanghai
      - DUBBO_PORT_TO_REGISTRY=6199
      - DUBBO_PORT_TO_BIND=6199
      - JAVA_OPTS=-XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m -Xms512m -Xmx512m -Xmn512m -Xss256k
        -javaagent:/app/agent/opentelemetry-javaagent.jar
        -Dotel.service.name=blog-gateway
        -Dotel.exporter.otlp.endpoint=http://192.168.9.200:4319
        -Dotel.exporter.otlp.protocol=grpc
        -Dotel.traces.exporter=otlp
        -Dotel.exporter.otlp.insecure=true
        -Dotel.instrumentation.common.default-enabled=true
        -Dotel.logs.exporter=none
    volumes:
      - /opt/install/opentelemetry/agent:/app/agent
    # 健康检查
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:6101/actuator/health"]
      interval: 30s
      timeout: 5s
      retries: 3
    networks:
      - app-network